# 工作流：修复 BUG (Bug Fix Workflow)

- 责任边界：定义在 KnowLattice 项目中发现、分析并修复 Bug 的标准化流程。
- 目录映射：`docs/ai/workflows/bug-fix.md`。

## 步骤详解

### 1. 复现 (Reproduction)
- **动作**：编写一个能触发该 Bug 的最小测试用例（后端：`#[test]`；前端：手动验证步骤）。
- **目标**：确保问题是可观测、可重复的。

### 2. 定位 (Context Routing)
- **工具**：使用 `AGENTS.md` 中的“上下文加载路由表”找到相关模块。
- **动作**：阅读相关文档（如 `services.md`, `storage.md`）和代码。

### 3. 根本原因分析 (Root Cause Analysis)
- **思考**：为什么会出现这个 Bug？是逻辑漏洞、状态同步问题还是违反了架构原则（如 SRP/DIP）？
- **输出**：在回复中简要说明你的发现，而非直接给出代码。

### 4. 实施修复 (Fix)
- **准则**：
    - **定位根本原因**：必须找到并解决引发 Bug 的具体代码逻辑，严禁在未理解原因的情况下进行“兜底”处理（如盲目使用空值检查、空的 `try-catch` 或未加思索的默认返回值）。
    - **对症下药**：修复根源，而非仅仅掩盖表面症状。
    - **最小影响**：不要引入不相关的代码改动（参考 `AGENTS.md` 第 7 章）。
    - **一致性**：保持与项目现有的错误处理和命名规范一致。

### 5. 验证 (Verification)
- **动作**：
    - 运行第 1 步创建的测试用例，确保其通过。
    - 运行 `cargo check` 和受影响模块的所有测试，确保无回归。
    - 列出手动验证的步骤（如果是 UI Bug）。

### 6. 记录 (Log)
- **动作**：在 `docs/process/task-log.md` 中记录该修复，特别是如果它涉及架构调整。
- **Commit**：使用 `fix(<scope>): <description>` 格式。

## 注意事项
- **禁止猜测**：如果你无法复现 Bug，请向用户寻求更多信息，不要盲目猜测。
- **优先测试**：对于逻辑 Bug，优先通过添加单元测试来修复。
